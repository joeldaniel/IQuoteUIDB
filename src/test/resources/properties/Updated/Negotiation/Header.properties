Query=DECLARE @BaseEst VARCHAR(10), @ActualEst VARCHAR(10) \
SET @BaseEst=+BaseEstimate+ \
SET @ActualEst=+ActualEstimate+ \
Begin \
Select (case when (Base.OptionDesc= Actual.OptionDesc) then 'Both are Equal' ELSE Base.OptionDesc + ' ' +Actual.OptionDesc  end) as OptionDesc, \
(case when (Base.Customer= Actual.Customer) then 'Both are Equal' ELSE Base.Customer + ' ' +Actual.Customer  end) as Customer, \
(case when (Base.SalesPerson= Actual.SalesPerson) then 'Both are Equal' ELSE Base.SalesPerson + ' ' +Actual.SalesPerson  end) as SalesPerson, \
(case when (Base.PaymentTerm= Actual.PaymentTerm) then 'Both are Equal' ELSE Base.PaymentTerm + ' ' +Actual.PaymentTerm  end) as PaymentTerm, \
(case when (Base.Title= Actual.Title) then 'Both are Equal' ELSE Base.Title + ' ' +Actual.Title  end) as Title, \
(case when (Base.CurrencySymbol= Actual.CurrencySymbol) then 'Both are Equal' ELSE Base.CurrencySymbol + ' ' +Actual.CurrencySymbol  end) as CurrencySymbol, \
(case when (Base.Currency= Actual.Currency) then 'Both are Equal' ELSE Base.Currency + ' ' +Actual.Currency  end) as Currency, \
(case when (Base.Contact= Actual.Contact) then 'Both are Equal' ELSE Base.Contact + ' ' +Actual.Contact  end) as Contact, \
(case when (Base.Agency is null and  Actual.Agency is null) then 'Both are Equal' ELSE Base.Agency + ' ' +Actual.Agency  end) as Agency, \
(case when (Base.CostRefDate= Actual.CostRefDate) then 'Both are Equal' ELSE cast(Base.CostRefDate as varchar(50)) + ' ' +cast(Actual.CostRefDate as varchar(50))  end) as CostRefDate, \
(case when (Base.Product= Actual.Product) then 'Both are Equal' ELSE Base.Product + ' ' +Actual.Product  end) as Product, \
(case when (Base.TotalCmp= Actual.TotalCmp) then 'Both are Equal' ELSE cast(Base.TotalCmp as varchar(50)) + ' ' +cast(Actual.TotalCmp as varchar(50))  end) as TotalCmp \
 from (SELECT  \
				OptionDesc, \
                Customer, \
                SalesPerson, \
                PaymentTerm, \
                Title, \
                CurrencySymbol, \
                Currency,             \
                Contact, \
                Agency,                 \
                CostRefDate,      \
                Product, \
                SUM(PscmpQtyTotal) TotalCmp                             \
FROM ( SELECT   \
                                   qttTMQuote.IdQuote                    AS IdQuote,   \
                                   qttTMQuote.Description                AS Title,   \
                                   qttTMQuote.InsUser                    AS InsUser,   \
                                   qttTMQuote.UpdUser                    AS UpdUser,   \
                                   qttTMQuote.InsDt                      AS InsDtQuote,   \
                                   CustomerService.FullName              AS SalesPerson,   \
                                   Customer.Name                         AS Customer,   \
                                   CustomerContact.Name                  AS Contact,   \
                                   Brok.Name                             AS Agency,   \
                                   qttTMSalesRule.PriceTableRefDt        AS PriceTableRefDt,   \
                                   qttTMSalesRule.CostTableRefDt         AS CostRefDate,   \
                                   genTCPaymentForm.Description          AS PaymentTerm,   \
                                   genTCCurrency.Description             AS Currency,   \
                                   genTCCurrency.CurrencySymbol          AS CurrencySymbol,   \
                                   qttTCPrdGroup.Description             AS Product,   \
                                   qttTMItemOptionQty.ItemOptionQtyOrder AS OptQtd,   \
                                   qttTMItemOptionQty.IdItemOptionQty    AS IdItemOptionQty,   \
                                   qttTMItemOption.IdItemOption          AS IdItemOption,   \
                                   qttTMItemOptionQtyPSCmp.PSCmpQtyTotal,   \
                                   qttTMItemOption.Description           AS OptionDesc                                  \
                                FROM [+BaseDBserver+].[+DB+].[dbo].qttTMQuote                      WITH (NOLOCK)                                \
                                INNER JOIN [+BaseDBserver+].[+DB+].[dbo].crmTCActor CustomerService WITH  (NOLOCK)ON CustomerService.IdActor = \ qttTMQuote.IdCustomerService                                  \
                                INNER JOIN [+BaseDBserver+].[+DB+].[dbo].crmTCActor Customer      WITH   (NOLOCK)ON Customer.IdActor = qttTMQuote.IdCustomer                                \
                                INNER JOIN [+BaseDBserver+].[+DB+].[dbo].crmTCActor CustomerContact WITH  (NOLOCK)ON CustomerContact.IdActor = \ qttTMQuote.IdCustomerContact                               \
                                LEFT JOIN [+BaseDBserver+].[+DB+].[dbo].crmTCActor Brok          WITH    (NOLOCK)ON Brok.IdActor = qttTMQuote.IdBroker   \
                                INNER JOIN [+BaseDBserver+].[+DB+].[dbo].qttTMItem               WITH    (NOLOCK)ON qttTMItem.IdQuote = qttTMQuote.IdQuote   \
                                INNER JOIN [+BaseDBserver+].[+DB+].[dbo].qttTMItemOption          WITH   (NOLOCK)ON qttTMItemOption.IdItem = qttTMItem.IdItem   \
                                INNER JOIN [+BaseDBserver+].[+DB+].[dbo].qttTMItemOptionQty       WITH   (NOLOCK)ON qttTMItemOptionQty.IdItemOption = qttTMItemOption.IdItemOption   \
                                INNER JOIN [+BaseDBserver+].[+DB+].[dbo].qttTMItemOptionQtyPSCmp  WITH   (NOLOCK)ON qttTMItemOptionQtyPSCmp.IdItemOptionQty = \ qttTMItemOptionQty.IdItemOptionQty                               \
                                INNER JOIN [+BaseDBserver+].[+DB+].[dbo].qttTMSalesRule           WITH   (NOLOCK)ON qttTMSalesRule.IdSalesRule = qttTMItem.IdSalesRule                             \
                                INNER JOIN [+BaseDBserver+].[+DB+].[dbo].genTCPaymentForm        WITH    (NOLOCK)ON genTCPaymentForm.IdPaymentForm = \ qttTMSalesRule.IdPaymentForm                             \
                                INNER JOIN [+BaseDBserver+].[+DB+].[dbo].genTCCurrency             WITH  (NOLOCK)ON genTCCurrency.IdCurrency = qttTMSalesRule.IdCurrency                              \
                                INNER JOIN [+BaseDBserver+].[+DB+].[dbo].qttTCPrdGroup           WITH    (NOLOCK)ON qttTCPrdGroup.IdPrdGroup = qttTMQuote.IDPrdGroup ) qttSCHeaderDemQuote \
WHERE \
                IdQuote = @BaseEst \
GROUP BY     \
                OptionDesc, \
                Customer, \
                SalesPerson, \
                PaymentTerm, \
                Title, \
                Currency, \
                CurrencySymbol, \
                Contact, \
                Agency,                 \
                CostRefDate,      \
                Product    ) Base \
                                                          LEFT JOIN \
                                                          (SELECT    \
				 OptionDesc, \
                Customer, \
                SalesPerson, \
                PaymentTerm, \
                Title, \
                CurrencySymbol, \
                Currency,             \
                Contact, \
                Agency,                 \
                CostRefDate,      \
                Product, \
                SUM(PscmpQtyTotal) TotalCmp                              \
FROM ( SELECT   \
                                   qttTMQuote.IdQuote                    AS IdQuote,   \
                                   qttTMQuote.Description                AS Title,   \
                                   qttTMQuote.InsUser                    AS InsUser,   \
                                   qttTMQuote.UpdUser                    AS UpdUser,   \
                                   qttTMQuote.InsDt                      AS InsDtQuote,   \
                                   CustomerService.FullName              AS SalesPerson,   \
                                   Customer.Name                         AS Customer,   \
                                   CustomerContact.Name                  AS Contact,   \
                                   Brok.Name                             AS Agency,   \
                                   qttTMSalesRule.PriceTableRefDt        AS PriceTableRefDt,   \
                                   qttTMSalesRule.CostTableRefDt         AS CostRefDate,   \
                                   genTCPaymentForm.Description          AS PaymentTerm,   \
                                   genTCCurrency.Description             AS Currency,   \
                                   genTCCurrency.CurrencySymbol          AS CurrencySymbol,   \
                                   qttTCPrdGroup.Description             AS Product,   \
                                   qttTMItemOptionQty.ItemOptionQtyOrder AS OptQtd,   \
                                   qttTMItemOptionQty.IdItemOptionQty    AS IdItemOptionQty,   \
                                   qttTMItemOption.IdItemOption          AS IdItemOption,   \
                                   qttTMItemOptionQtyPSCmp.PSCmpQtyTotal,   \
                                   qttTMItemOption.Description           AS OptionDesc                                    \
                                FROM [+ActualDBserver+].[+DB+].[dbo].qttTMQuote                      WITH (NOLOCK)                                \
                                INNER JOIN [+ActualDBserver+].[+DB+].[dbo].crmTCActor CustomerService WITH  (NOLOCK)ON CustomerService.IdActor = \ qttTMQuote.IdCustomerService                                \
                                INNER JOIN [+ActualDBserver+].[+DB+].[dbo].crmTCActor Customer      WITH   (NOLOCK)ON Customer.IdActor = qttTMQuote.IdCustomer                               \
                                INNER JOIN [+ActualDBserver+].[+DB+].[dbo].crmTCActor CustomerContact WITH  (NOLOCK)ON CustomerContact.IdActor = \ qttTMQuote.IdCustomerContact                                 \
                                LEFT JOIN  [+ActualDBserver+].[+DB+].[dbo].crmTCActor Brok          WITH    (NOLOCK)ON Brok.IdActor = qttTMQuote.IdBroker   \
                                INNER JOIN [+ActualDBserver+].[+DB+].[dbo].qttTMItem               WITH    (NOLOCK)ON qttTMItem.IdQuote = qttTMQuote.IdQuote   \
                                INNER JOIN [+ActualDBserver+].[+DB+].[dbo].qttTMItemOption          WITH   (NOLOCK)ON qttTMItemOption.IdItem = qttTMItem.IdItem   \
                                INNER JOIN [+ActualDBserver+].[+DB+].[dbo].qttTMItemOptionQty       WITH   (NOLOCK)ON qttTMItemOptionQty.IdItemOption = qttTMItemOption.IdItemOption   \
                                INNER JOIN [+ActualDBserver+].[+DB+].[dbo].qttTMItemOptionQtyPSCmp  WITH   (NOLOCK)ON qttTMItemOptionQtyPSCmp.IdItemOptionQty = \ qttTMItemOptionQty.IdItemOptionQty                                \
                                INNER JOIN [+ActualDBserver+].[+DB+].[dbo].qttTMSalesRule           WITH   (NOLOCK)ON qttTMSalesRule.IdSalesRule = qttTMItem.IdSalesRule                                \
                                INNER JOIN [+ActualDBserver+].[+DB+].[dbo].genTCPaymentForm        WITH    (NOLOCK)ON genTCPaymentForm.IdPaymentForm = qttTMSalesRule.IdPaymentForm                             \
                                INNER JOIN [+ActualDBserver+].[+DB+].[dbo].genTCCurrency             WITH  (NOLOCK)ON genTCCurrency.IdCurrency = qttTMSalesRule.IdCurrency                               \
                                INNER JOIN [+ActualDBserver+].[+DB+].[dbo].qttTCPrdGroup           WITH    (NOLOCK)ON qttTCPrdGroup.IdPrdGroup = qttTMQuote.IDPrdGroup ) qttSCHeaderDemQuote \
WHERE \
                IdQuote = @ActualEst \
GROUP BY     \
                OptionDesc, \
                Customer, \
                SalesPerson, \
                PaymentTerm, \
                Title, \
                Currency, \
                CurrencySymbol, \
                Contact, \
                Agency,                 \
                CostRefDate,      \
                Product    ) Actual ON                                                           \
                                                          Base.OptionDesc=Actual.OptionDesc OR  \
                                                          Base.Customer=Actual.Customer OR  \
                                                          Base.SalesPerson=Actual.SalesPerson OR \
                                                         Base.PaymentTerm=Actual.PaymentTerm OR \
                                                          Base.Title=Actual.Title OR \
                                                         Base.CurrencySymbol=Actual.CurrencySymbol OR \
                                                          Base.Currency=Actual.Currency OR \
                                                          Base.Contact=Actual.Contact OR \
                                                          Base.Agency=Actual.Agency OR \
                                                         Base.CostRefDate=Actual.CostRefDate OR \
                                                          Base.Product= Actual.Product OR \
                                                          Base.TotalCmp= Actual.TotalCmp \
end 